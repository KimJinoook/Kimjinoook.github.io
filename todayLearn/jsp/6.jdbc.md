# 상품등록 예제
### pdWrite.jsp
```html
<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>pdWrite.jsp</title>
</head>
<body>
	<h1>상품 등록</h1>
	<form method="post" action="pdWrite_ok.jsp">
		상품명 : <input type = "text" name ="pdName"><br>
		가격 : <input type = "text" name ="price"><br><br>
		<input type = "submit" value = "등록">
		<input type = "reset" value = "취소">
	</form>
	<br>
	<a href="pdList.jsp">상품 목록</a>
</body>
</html>
```

### pdWrite_ok.jsp
```html
<%@page import="java.sql.*"%>
<%@page import="com.mystudy.pd.model.*" %>
<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>pdWrite_ok.jsp</title>
</head>
<body>
	<%
		//pdWrite.jsp에서 post 방식으로 submit
		
		request.setCharacterEncoding("euc-kr");
		//1.요청 파라미터 읽어오기
		String pdName = request.getParameter("pdName");
		String price = request.getParameter("price");
		
		//2.DB작업
		PdDAO dao = new PdDAO();
		PdDTO dto = new PdDTO();
		dto.setPdName(pdName);
		dto.setPrice(Integer.parseInt(price));
		
		try{
			int cnt = dao.insertPd(dto);
			
			if(cnt>0){
				response.sendRedirect("pdList.jsp");
			}else{
				System.out.println("상품등록 실패");
				response.sendRedirect("pdWrite.jsp");
			}
		}catch(SQLException e){
			e.printStackTrace();
		}
		
		//3.결과처리
		
	%>

</body>
</html>
```



### ConnectionPoolMgr.java
```java
package com.mystudy.pd.model;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class ConnectionPoolMgr {
	public ConnectionPoolMgr() {
		//1. 드라이버 로딩
		try {
			Class.forName("oracle.jdbc.driver.OracleDriver");
			System.out.println("드라이버 로딩 성공");
		} catch (ClassNotFoundException e) {
			System.out.println("드라이버 로딩 실패");
			e.printStackTrace();
		}
		
	}
	public Connection getConnection(String url, String uid, String upwd) throws SQLException {
		Connection con = DriverManager.getConnection(url, uid, upwd);
		System.out.println("db연결 : con = "+con);
		
		return con;
	}
	public Connection getConnection(String uid, String upwd) throws SQLException {
		String url = "jdbc:oracle:thin:@localhost:1521:xe";
		Connection con = DriverManager.getConnection(url, uid, upwd);
		System.out.println("db연결 : con = "+con);
		
		return con;
	}
	public Connection getConnection() throws SQLException {
		String url = "jdbc:oracle:thin:@localhost:1521:xe";
		String uid = "javauser";
		String upwd = "javauser123";
		Connection con = DriverManager.getConnection(url, uid, upwd);
		System.out.println("db연결 : con = "+con);
		
		return con;
	}
	public void dbClose(ResultSet rs, PreparedStatement ps, Connection con) throws SQLException {
		if(rs!=null) rs.close();
		if(ps!=null) ps.close();
		if(con!=null) con.close();
	}
	public void dbClose(PreparedStatement ps, Connection con) throws SQLException {
		if(ps!=null) ps.close();
		if(con!=null) con.close();
	}
}

```

### PdDTO
```java
package com.mystudy.pd.model;

import java.sql.Timestamp;

public class PdDTO {
   //1. private 멤버변수
   private int no;
   private String pdName; //마우스
   private int price; //19000
   private Timestamp regdate;

   //2. 생성자
   public PdDTO() {
      super();
   }

   public PdDTO(int no, String pdName, int price, Timestamp regdate) {
      super();
      this.no = no;
      this.pdName = pdName;
      this.price = price;
      this.regdate = regdate;
   }

   //3. getter/setter
   public int getNo() {
      return no;
   }

   public void setNo(int no) {
      this.no = no;
   }

   public String getPdName() {
      return pdName;
   }

   public void setPdName(String pdName) {
      this.pdName = pdName;
   }

   public int getPrice() {
      return price;
   }

   public void setPrice(int price) {
      this.price = price;
   }

   public Timestamp getRegdate() {
      return regdate;
   }

   public void setRegdate(Timestamp regdate) {
      this.regdate = regdate;
   }

   //4. toString()
   @Override
   public String toString() {
      return "PdDTO [no=" + no + ", pdName=" + pdName + ", price=" + price + ", regdate=" + regdate + "]";
   }

}

```

### PdDAO
```html
package com.mystudy.pd.model;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class PdDAO {
	private ConnectionPoolMgr pool;
	
	public PdDAO() {
		pool = new ConnectionPoolMgr();
	}
	public int insertPd(PdDTO dto) throws SQLException {
		Connection con = null;
		PreparedStatement ps = null;
		int cnt = 0;
		try {
			con = pool.getConnection();
			
			String sql = "insert into pd values(pd_seq.nextval, ?, ?, sysdate)";
			ps = con.prepareStatement(sql);
			ps.setString(1, dto.getPdName());
			ps.setInt(2, dto.getPrice());
			cnt = ps.executeUpdate();
			System.out.println("dto = "+dto+", cnt = "+cnt);
			return cnt;
		}finally {
			pool.dbClose(ps, con);
		}
		
	}
}

```
