# PL/SQL
## 1. PL/SQL이란
- Procedual Language extension to Structured Query Language
- SQL과 일반 프로그래밍 언어의 특성을 결합
- 변수 상수 선언 가능
- 조건문 반복문 사용 가능
- DBMS의 역할이 커지면서 SQL을 넘어서는 일반 프로그래밍 언어의 기능이 필요하게 되었다
  - 1989년 오라클 6버전부터 등장

### a. 기본구조
- 선언부 (Declarative part)
  - 실행부에서 사용할 변수나 상수 선언
  - 변수와 상수 선언은 반드시 선언부에서만 선언
  - Declare 사용
- 실행부 (Executable part)
  - 셀지 처리할 로직 부분 담당
  - 변수에 값 할당, if, while, sql 등
  - 실행부에 여러개의 sql문장들을 순차적으로 사용
  - 블록 단위로 한번에 처리
  - Begin으로 시작, End로 끝
- 예외처리부 (Exception-building part)
  - 로직 처리의 오류처리부분
  - Exception 사용   


- 기본구조   

```sql
declare
  counter INTEGER; --선언부
begin
  counter := 10;
  counter := counter /0;
  dbms_output.put_line(counter); --실행부
exception when others then
  dbms_output.put_line('ERRORS'); --예외처리부
end;
```

- if문 예   
```sql
declare --선언부 - 변수 선언
    counter number;
    
begin --실행부 - 로직처리
    counter :=1; --변수에 값 할당
    
    --로직처리
    counter := counter/0;
    
    if counter is not null then
        dbms_output.put_line('counter => ' || counter);
    end if;
    
    exception when others then --예외처리부
        dbms_output.put_line('0으로 나누면 안됩니다');
end;

--dbms 출력 : 0으로 나누면 안됩니다
```

- for문 예   
```sql
declare
    i number;
    rst number;
begin
    for i in 1..10 loop
        rst := i*2;
        dbms_output.put_line(rst);
    end loop;
    
    exception when others then
        dbms_output.put_line('error');
end;

2
4
6
8
10
12
14
16
18
20
```

- while문 예   

```sql
declare
    i number;
    result number;
begin
    i := 1;
    while i<=10 loop
        result := i*3;
        dbms_output.put_line(i||'*3 = ' ||result);
        i:=i+1;
    end loop;

    exception when others then
        dbms_output.put_line('error');
        
end;

1*3 = 3
2*3 = 6
3*3 = 9
4*3 = 12
5*3 = 15
6*3 = 18
7*3 = 21
8*3 = 24
9*3 = 27
10*3 = 30
```


### b. 변수와 상수
> 변수명 데이터타입;   
> 상수명 constant 데이터타입;   
> 변수명 테이블명.컬럼명%type;   


### c. 조건문
- if문   

```sql
if 조건 then
  처리문1;
elsif 조건2 then
  처리문2;
else
  처리문3;
end if;

--java와 다르게, else if 가 아니라 elsif, e가 없다


declare
    grade char;
    result clob;
begin
    grade := 'B';
    
    if grade = 'A' then
        result := 'Excellent';
    elsif grade = 'B' then
        result := 'Good';
    elsif grade = 'C' then
        result := 'Fair';
    elsif grade = 'D' then
        result :='Poor';
    else
        result := 'Not found!';
    end if;
        dbms_output.put_line(grade || '=>' || result);
    
    exception when others then
        dbms_output.put_line('error');
end;
```

- case문   

```sql
case 변수
  when 조건 then 명령문
  when 조건2 then 명령문
  else 명령문
end case;


declare
    grade char;
    result varchar2(50);
begin
    grade := 'C';
    
    case grade
        when 'A' then
            result := 'Excellent';
        when 'B' then
            result := 'Good';
        when 'C' then
            result := 'Fair';
        when 'D' then
            result := 'Poor';
        else
            result := 'Not found';
        end case;
    dbms_output.put_line(grade || '=>' || result);
    
    exception when others then
        dbms_output.put_line('error');
end;
```

### d. 반복문
- loop 문   

```sql
loop
  처리문장
end loop
 
declare
    i number;
    result number;
    
begin
    i := 1;
    
    loop
        result := i*2;
        exit when result > 20;
        dbms_output.put_line(result);
        i := i+1;
    end loop;
    exception when others then
        dbms_output.put_line('errer');
end;
```
***

## 2. 함수

***

## 3. 저장프로시저

***

## 4. 커서
